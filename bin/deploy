#!/bin/sh

set -e

cd "$(dirname "$0")"/..

(. .env 2>/dev/null; [ "$APP_ENV" = "production" ]) || bin/gencert

(
    set +e
    docker compose up -d --build
    ret=$?

    docker image prune -f >/dev/null
    docker buildx prune -f >/dev/null

    exit $ret
)

echo "Deploy successful."
