#!/bin/sh

set -e

cd "$(dirname "$0")"/..

bin/gencert
bin/fetch_images
bin/portainer

(
    set +e
    docker compose up -d --build
    ret=$?

    docker image prune -f >/dev/null
    docker buildx prune -f >/dev/null

    exit $ret
)

echo "Deploy successful."
