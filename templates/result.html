{% extends 'base.html' %}

{% block content %}
  <div id="processing" hidden>
    <h2>Processing</h2>
    <div class="spinner-border my-3" role="status">
      <span class="visually-hidden">Please wait...</span>
    </div>
    <p id="processing-status" class="invisible"></p>
    <form action="{{ url_for('cancel', session_id=request.view_args['session_id'],
      job_id=request.view_args['job_id']) }}" method="post">
      {{ cancel_form.csrf_token }}
      <button type="submit" class="btn btn-sm btn-outline-danger">Cancel</button>
    </form>
  </div>
  <div id="result" hidden>
    <h2>{% block title %}Your stylized image{% endblock %}</h2>
    <div class="my-3"><img id="result-image" class="img-thumbnail" src="" alt=""></div>
    <p>
      <a class="btn btn-primary" href="{{ url_for('image', session_id=request.view_args['session_id'],
        job_id=request.view_args['job_id'], filename=filename, download=1) }}">Download</a>
    </p>
    <p class="text-body-tertiary">
      Your image will be available for <strong>{{ settings.RESULT_TTL_MINUTES }} minutes</strong>.
    </p>
  </div>
  <div id="job-error" hidden>
    <h2>Error</h2>
    <p>There was a problem processing your image.</p>
  </div>
  <div id="ajax-error" hidden>
    <h2>Error</h2>
    <p>Unable to retrieve the status of your image.</p>
    <p>Reason: <span id="ajax-error-reason"></span></p>
  </div>
  <script id="state-data" type="application/json">
    {
      "initialStatus": "{{ status }}",
      "initialQueuePosition": {{ position if position is not none else 'null' }},
      "statusUrl": "{{ url_for('status', session_id=request.view_args['session_id'],
        job_id=request.view_args['job_id']) }}",
      "pollInterval": {{ settings.AJAX_POLL_INTERVAL }},
      "requestTimeout": {{ settings.AJAX_TIMEOUT }},
      "resultUrl": "{{ url_for('image', session_id=request.view_args['session_id'],
        job_id=request.view_args['job_id'], filename=filename) }}"
    }
  </script>
{% endblock %}
